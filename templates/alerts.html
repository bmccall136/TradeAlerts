{% extends "layout.html" %}

{% block status_left %}
  <span class="badge badge-success status-text market">
    Yahoo Finance Intraday: Open
  </span>
  <span class="badge badge-success status-text etrade">
    E*TRADE API: Connected
  </span>
  <a href="#" class="status-link">Reconnect API</a>
{% endblock %}

{% block status_right %}
  <span class="badge badge-success">Flask API Online</span>
  <span class="badge badge-primary">JS Running</span>
{% endblock %}

{% block content %}
  <div class="filter-bar my-3 text-center">
    <form method="post" action="{{ url_for('clear_filtered') }}" class="d-inline">
      <input type="hidden" name="filter" value="{{ current_filter }}">
      <button type="submit" class="btn btn-outline-light btn-sm" {% raw %}{% if not alerts %}disabled{% endif %}{% endraw %}>
        Clear All
      </button>
    </form>
    &nbsp;
    <span>Filter:</span>
    {% for f,label in [
         ('all','All'),
         ('prime','Prime ðŸ’Ž'),
         ('sharpshooter','Sharpshooter ðŸŽ¯'),
         ('sell','Sell ðŸ”¥'),
         ('simulation','Simulation')
       ] %}
      <a href="{{ url_for('alerts_index', filter=f) }}"
         class="btn btn-outline-light btn-sm {% raw %}{% if current_filter==f %}active{% endif %}{% endraw %}">
        {{ label }}
      </a>
    {% endfor %}
  </div>

  <div class="table-responsive">
    <table class="table table-dark table-striped table-bordered alerts">
      <thead class="thead-dark">
        <tr>
          <th>Symbol</th>
          <th>Name</th>
          <th>Signal</th>
          <th>Conf.</th>
          <th>Price</th>
          <th>Timestamp</th>
          <th>Spark</th>
          <th>VWAP</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for a in alerts %}
        <tr>
          <td>{{ a.symbol }}</td>
          <td>{{ a.name }}</td>
          <td>{{ a.signal }}</td>
          {% if a.confidence is defined %}
            <td>{{ '%.1f'|format(a.confidence) }}%</td>
          {% else %}
            <td>N/A</td>
          {% endif %}
          <td>${{ '%.2f'|format(a.price) }}</td>
          <td>
            {% if a.timestamp %}
              {{ a.timestamp[:19] }}
            {% else %}
              --
            {% endif %}
          </td>
          <td><!-- sparkline injected by JS --></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
