{% extends "layout.html" %}

{% block status_left %}
  <span class="badge badge-success">Yahoo Finance Intraday: Open</span>
  <span class="badge badge-success">E*TRADE API: Connected</span>
  <a href="#" class="status-link">Reconnect API</a>
{% endblock %}

{% block status_right %}
  <span class="badge badge-success">Flask API Online</span>
  <span class="badge badge-primary">JS Running</span>
{% endblock %}

{% block content %}
  <div class="filter-bar my-3 text-center">
    <form method="post" action="{{ url_for('clear_filtered') }}" class="d-inline">
      <button type="submit" class="btn btn-outline-light">Clear All</button>
      <input type="hidden" name="filter" value="{{ current_filter }}">
    </form>
    <span class="mx-2">Filter:</span>
    <a href="{{ url_for('alerts_index', filter='all') }}" class="btn btn-sm btn-light{% if current_filter=='all' %} active{% endif %}">All</a>
    <a href="{{ url_for('alerts_index', filter='prime') }}" class="btn btn-sm btn-light{% if current_filter=='prime' %} active{% endif %}">Prime ðŸ’Ž</a>
    <a href="{{ url_for('alerts_index', filter='sharpshooter') }}" class="btn btn-sm btn-light{% if current_filter=='sharpshooter' %} active{% endif %}">Sharpshooter ðŸŽ¯</a>
    <a href="{{ url_for('alerts_index', filter='sell') }}" class="btn btn-sm btn-light{% if current_filter=='sell' %} active{% endif %}">Sell ðŸ”¥</a>
    <a href="{{ url_for('alerts_index', filter='simulation') }}" class="btn btn-sm btn-light{% if current_filter=='simulation' %} active{% endif %}">Simulation</a>
  </div>

  <div class="table-responsive">
    <table class="table table-dark table-striped table-bordered">
      <thead class="thead-dark">
        <tr>
          <th>Symbol</th><th>Name</th><th>Signal</th><th>Conf.</th><th>Price</th><th>Spark</th><th>VWAP</th><th>Action</th>
        </tr>
      </thead>
      <tbody id="alerts-body">
        {% for a in alerts %}
        <tr>
          <td>{{ a.symbol }}</td>
          <td>{{ a.name }}</td>
          <td>{{ a.signal or '' }}</td>
          <td>{{ '%.1f%%'|format(a.confidence) }}</td>
          <td>${{ '%.2f'|format(a.price) }}</td>
          <td><!-- sparkline injected by JS --></td>
          <td>${{ '%.2f'|format(a.vwap) }}</td>
          <td>
            <form method="post" action="{{ url_for('clear_one', alert_id=a.id) }}">
              <input type="hidden" name="filter" value="{{ current_filter }}">
              <button type="submit" class="btn btn-sm btn-outline-light">Clear</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
