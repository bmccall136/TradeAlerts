<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TradeAlerts - Alerts</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="black-bg">
    <nav class="navbar">
        <div class="navbar-brand">ðŸš€ TradeAlerts</div>
        <div class="navbar-links">
            <a href="{{ url_for('alerts') }}" class="nav-link{% if request.path == '/alerts' %} active{% endif %}">Alerts</a>
            <a href="{{ url_for('simulation') }}" class="nav-link{% if request.path == '/simulation' %} active{% endif %}">Simulation</a>
            <a href="{{ url_for('backtest') }}" class="nav-link{% if request.path == '/backtest' %} active{% endif %}">Backtest</a>
            <a href="{{ url_for('config') }}" class="nav-link{% if request.path == '/config' %} active{% endif %}">Settings</a>
        </div>
    </nav>
    <h1 class="page-title">ðŸš€ Trade Alerts ðŸš€</h1>
    <div class="alerts-table-wrapper">
        <table class="alerts-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Triggers</th>
                    <th>Spark</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for alert in alerts %}
                <tr>
                    <td>{{ alert[5] }}</td>
                    <td>{{ alert[1] }}</td>
                    <td>{{ alert[6] }}</td>
                    <td>${{ '%.2f'|format(alert[2]|float) }}</td>
                    <td>{{ alert[3] }}</td>
                    <td>
                        {% if alert[4] %}
                            <img src="{{ alert[4] }}" class="sparkline-img" alt="sparkline">
                        {% endif %}
                    </td>
                    <td>
                        <input type="number" min="1" value="1" class="qty-input" id="qty-{{ alert[0] }}">
                        <button class="buy-btn" onclick="buyAlert({{ alert[0] }})">Buy</button>
                        <button class="clear-btn" onclick="clearAlert({{ alert[0] }})">Clear</button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <button class="clear-all-btn" onclick="clearAllAlerts()">Clear All</button>
    </div>
    <script>
        function clearAlert(alertId) {
            fetch(`/clear_alert/${alertId}`, {method: 'POST'})
            .then(res => res.json())
            .then(data => { if(data.status==='success') location.reload(); });
        }
        function clearAllAlerts() {
            fetch('/clear_all_alerts', {method:'POST'})
            .then(res => res.json())
            .then(data => { if(data.status==='success') location.reload(); });
        }
        function buyAlert(alertId) {
            let qty = document.getElementById('qty-' + alertId).value;
            fetch(`/buy/${alertId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({qty: qty})
            })
            .then(res => res.json())
            .then(data => { 
                if(data.status==='buy-placed') {
                    alert('Buy order placed: ' + qty + ' shares for alert #' + alertId);
                }
            });
        }
    </script>
</body>
</html>
