{% extends "layout.html" %}

{% block content %}
  <h2 class="sim-header">üöÄ Simulation Dashboard üöÄ</h2>
  <div class="sim-controls">
    <button id="reset-sim" class="btn-reset">Reset Simulation</button>
    <a href="/" class="back-link">‚Üê Back to Alerts</a>
  </div>

  <div class="sim-summary">
    <div>Cash: <strong>${{ simulation.cash | round(2) }}</strong></div>
    <div>Open Value: <strong>${{ simulation.open | round(2) }}</strong></div>
    <div>Realized P&L: <strong>${{ simulation.realized | round(2) }}</strong></div>
  </div>

  <table class="holdings">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Avg Price</th>
        <th>Current Price</th>
        <th>Total Shares</th>
        <th>Current Value</th>
        <th>P&L</th>
        <th>%</th>
        <th>Clear</th>
      </tr>
    </thead>
    <tbody>
      {% for h in simulation.holdings %}
      <tr>
        <td>{{ h.symbol }}</td>
        <td>${{ h.avg_price | round(2) }}</td>
        <td>${{ h.current_price | round(2) }}</td>
        <td>{{ h.quantity }}</td>
        <td>${{ h.current_value | round(2) }}</td>
        <td>${{ h.profit_loss | round(2) }}</td>
        <td>{{ h.profit_pct | round(2) }}%</td>
        <td>
          <form action="/holdings/{{ h.symbol }}/clear" method="post" class="clear-form">
            <button type="submit" class="btn-clear">Clear</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="8" class="no-holdings">No holdings</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Trade History</h3>
  <table class="trades">
    <thead>
      <tr>
        <th>Time</th>
        <th>Symbol</th>
        <th>Action</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Clear</th>
      </tr>
    </thead>
    <tbody>
      {% for t in simulation.trades %}
      <tr>
        <td>{{ t.timestamp }}</td>
        <td>{{ t.symbol }}</td>
        <td>{{ t.action }}</td>
        <td>{{ t.quantity }}</td>
        <td>${{ t.price | round(2) }}</td>
        <td>
          <form action="/trades/{{ t.id }}/clear" method="post" class="clear-form">
            <button type="submit" class="btn-clear">Clear</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="no-trades">No trades</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    document.getElementById('reset-sim').addEventListener('click', function() {
      fetch('/reset', { method: 'POST' })
        .then(() => location.reload());
    });
  </script>
{% endblock %}